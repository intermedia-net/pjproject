pool:
  name: MobileTeamPool
  demands: isSupportsIOS -equals true

steps:
  - script: |
      find $(Build.ArtifactStagingDirectory)/* -delete
      cd ios_framework
      ./build_ios_framework.sh --source-dir=$(Build.SourcesDirectory) --output-dir="$PWD/artifact" --name="pjsip-ios-$(Build.SourceBranchName)"
    displayName: 'Build framework'

  - task: CopyFiles@2
    displayName: 'Copy Files to build directory'
    inputs:
      SourceFolder: './ios_framework/artifact'
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: GitHubRelease@1
    displayName: 'Create GitHub release'
    inputs:
      gitHubConnection: 'Github PJSIP'
      title: 'PJSIP iOS $(Build.SourceBranchName)'
      isDraft: true
      addChangeLog: false